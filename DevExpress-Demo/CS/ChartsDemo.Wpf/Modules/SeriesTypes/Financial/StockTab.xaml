<local:TabItemModule
    x:Class="ChartsDemo.StockTab"
    x:Name="tabItemModule"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:ChartsDemo"
    xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:dxc="http://schemas.devexpress.com/winfx/2008/xaml/charts"
    xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
    mc:Ignorable="d"
    d:DesignHeight="450"
    d:DesignWidth="800">
    <!--#region Resources-->
    <local:TabItemModule.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary
                    Source="/ChartsDemo;component/Themes/Common.xaml" />
                <ResourceDictionary
                    Source="/ChartsDemo;component/Modules/SeriesTypes/Financial/CustomFinancialModels.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <DataTemplate
                x:Key="crosshairPopupTemplate">
                <Grid
                    Margin="12,0,0,12">
                    <Border
                        BorderBrush="{Binding BorderBrush}"
                        BorderThickness="1"
                        Background="LightGray">
                        <ItemsControl
                            Margin="12"
                            ItemsSource="{Binding PresentationData}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel
                                        Orientation="Vertical" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <ContentPresenter
                                        Focusable="False"
                                        HorizontalAlignment="{Binding Path=ElementAlignment}"
                                        VerticalAlignment="Stretch"
                                        Content="{Binding}"
                                        ContentTemplate="{Binding Path=CrosshairSeriesLabelTemplate}" />
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Border>
                </Grid>
            </DataTemplate>
            <DataTemplate
                x:Key="crosshairLabelTemplate">
                <Grid
                    UseLayoutRounding="True">
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition
                            Width="60" />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <Border
                        Background="#FFA1A1A1"
                        Grid.ColumnSpan="3"
                        Grid.Row="4"
                        Margin="1,8,1,0">
                        <TextBlock
                            TextAlignment="Center"
                            Text="{Binding SeriesPoint.Tag.TradeDate, StringFormat='{}{0:d}'}"
                            Height="30"
                            Foreground="White"
                            FontSize="14"
                            Padding="3,5,3,3"
                            FontWeight="Thin" />
                    </Border>
                    <Image
                        Stretch="None"
                        Source="{Binding SeriesPoint.Tag.ToolTipData.HighDynamic}"
                        Grid.Row="0"
                        Grid.Column="2"
                        Margin="2,0,5,0"
                        VerticalAlignment="Center" />
                    <Image
                        Stretch="None"
                        Source="{Binding SeriesPoint.Tag.ToolTipData.LowDynamic}"
                        Grid.Row="1"
                        Grid.Column="2"
                        Margin="2,0,5,0"
                        VerticalAlignment="Center" />
                    <Image
                        Stretch="None"
                        Source="{Binding SeriesPoint.Tag.ToolTipData.OpenDynamic}"
                        Grid.Row="2"
                        Grid.Column="2"
                        Margin="2,0,5,0"
                        VerticalAlignment="Center" />
                    <Image
                        Stretch="None"
                        Source="{Binding SeriesPoint.Tag.ToolTipData.CloseDynamic}"
                        Grid.Row="3"
                        Grid.Column="2"
                        Margin="2,0,5,0"
                        VerticalAlignment="Center" />
                    <TextBlock
                        Grid.Row="0"
                        Grid.Column="0"
                        Foreground="#FF404040"
                        Margin="10,2,10,2">High:</TextBlock>
                    <TextBlock
                        Grid.Row="1"
                        Grid.Column="0"
                        Foreground="#FF404040"
                        Margin="10,2,10,2">Low:</TextBlock>
                    <TextBlock
                        Grid.Row="2"
                        Grid.Column="0"
                        Foreground="#FF404040"
                        Margin="10,2,10,2">Open:</TextBlock>
                    <TextBlock
                        Grid.Row="3"
                        Grid.Column="0"
                        Foreground="#FF404040"
                        Margin="10,2,10,2">Close:</TextBlock>
                    <TextBlock
                        VerticalAlignment="Center"
                        Grid.Row="0"
                        Grid.Column="1"
                        Margin="3,2,3,2"
                        Text="{Binding SeriesPoint.Tag.High, StringFormat='{}{0:f2}'}"
                        TextAlignment="Right"
                        FontWeight="Bold"
                        Foreground="{Binding SeriesPoint.Tag.ToolTipData.HighFontBrush}" />
                    <TextBlock
                        VerticalAlignment="Center"
                        Grid.Row="1"
                        Grid.Column="1"
                        Margin="3,2,3,2"
                        Text="{Binding SeriesPoint.Tag.Low, StringFormat='{}{0:f2}'}"
                        TextAlignment="Right"
                        FontWeight="Bold"
                        Foreground="{Binding SeriesPoint.Tag.ToolTipData.LowFontBrush}" />
                    <TextBlock
                        VerticalAlignment="Center"
                        Grid.Row="2"
                        Grid.Column="1"
                        Margin="3,2,3,2"
                        Text="{Binding SeriesPoint.Tag.Open, StringFormat='{}{0:f2}'}"
                        TextAlignment="Right"
                        FontWeight="Bold"
                        Foreground="{Binding SeriesPoint.Tag.ToolTipData.OpenFontBrush}" />
                    <TextBlock
                        VerticalAlignment="Center"
                        Grid.Row="3"
                        Grid.Column="1"
                        Margin="3,2,3,2"
                        Text="{Binding SeriesPoint.Tag.Close, StringFormat='{}{0:f2}'}"
                        TextAlignment="Right"
                        FontWeight="Bold"
                        Foreground="{Binding SeriesPoint.Tag.ToolTipData.CloseFontBrush}" />
                </Grid>
            </DataTemplate>
        </ResourceDictionary>
    </local:TabItemModule.Resources>
    <!--#endregion-->

    <!--#region Options-->
    <local:TabItemModule.Options>
        <StackPanel
            Style="{StaticResource optionsRootStackPanelStyle}">
            <GroupBox
                Header="General">
                <StackPanel>
                    <dxe:CheckEdit
                        Name="cheWorkdaysOnly"
                        Content="Workdays Only"
                        IsChecked="True" />
                    <TextBlock
                        Grid.Row="1"
                        Grid.Column="0"
                        Text="Stock Type:"
                        Margin="{StaticResource optionsGroupTopMargin}" />
                    <dxe:ComboBoxEdit
                        Name="cbeStockType"
                        Margin="{StaticResource textUnderControlMargin}"
                        SelectedIndex="0">
                        <dxe:ComboBoxEdit.Items>
                            <sys:String>Both</sys:String>
                            <sys:String>Open</sys:String>
                            <sys:String>Close</sys:String>
                        </dxe:ComboBoxEdit.Items>
                    </dxe:ComboBoxEdit>
                </StackPanel>
            </GroupBox>
            <GroupBox
                Header="Reduction Options">
                <StackPanel>
                    <TextBlock
                        Text="Mode:" />
                    <dxe:ComboBoxEdit
                        x:Name="cbeReductionMode"
                        SelectedIndex="0"
                        ItemsSource="{dxe:EnumItemsSource EnumType=dxc:ReductionColorMode}"
                        Margin="{StaticResource textUnderControlMargin}" />
                    <TextBlock
                        Text="Reduction Level:"
                        Margin="{StaticResource optionsGroupTopMargin}" />
                    <dxe:ComboBoxEdit
                        x:Name="cbeReductionLevel"
                        ItemsSource="{dxe:EnumItemsSource EnumType=dxc:StockLevel}"
                        Margin="{StaticResource textUnderControlMargin}"
                        SelectedIndex="3"
                        IsEnabled="{Binding RelativeSource={RelativeSource AncestorType={x:Type StackPanel}}, Path=Children[1].EditValue, Converter={local:ReductionModeToReductionValueEnabledConverter}}"/>
                    <TextBlock
                        Text="Base Color:"
                        Margin="{StaticResource optionsGroupTopMargin}" />
                    <dxe:PopupColorEdit
                        Margin="{StaticResource textUnderControlMargin}"
                        Color="Black"
                        x:Name="pceBaseColor" />
                    <TextBlock
                        Text="Reduction Color:"
                        Margin="{StaticResource optionsGroupTopMargin}" />
                    <dxe:PopupColorEdit
                        Margin="{StaticResource textUnderControlMargin}"
                        Color="Red"
                        x:Name="pceReductionColor" />
                </StackPanel>
            </GroupBox>
            <GroupBox
                Header="Model">
                <dxe:ListBoxEdit
                    Name="lbeModel"
                    DisplayMember="ModelName"
                    SelectedItem="{x:Reference thinModel}">
                    <dxe:ListBoxEdit.StyleSettings>
                        <dxe:RadioListBoxEditStyleSettings />
                    </dxe:ListBoxEdit.StyleSettings>
                    <dxe:ListBoxEdit.Items>
                        <dxc:DropsStock2DModel />
                        <dxc:ArrowsStock2DModel />
                        <dxc:ThinStock2DModel
                            x:Name="thinModel" />
                        <dxc:FlatStock2DModel />
                        <dxc:CustomStock2DModel
                            PointTemplate="{StaticResource customStockPointTemplate}" />
                    </dxe:ListBoxEdit.Items>
                </dxe:ListBoxEdit>
            </GroupBox>
        </StackPanel>
    </local:TabItemModule.Options>
    <!--#endregion-->

    <DockPanel
        Loaded="{DXEvent '@e(tabItemModule).IsModuleLoaded ? @e(chart).Animate() : null'}">

        <dxc:ChartControl
            Name="chart"
            DataSource="{DXBinding 'new $local:FinancialDataLoader().GetGoogleStockData()'}"
            AnimationMode="OnLoad">
            <!--#region CrosshairOptions-->
            <dxc:ChartControl.CrosshairOptions>
                <dxc:CrosshairOptions
                    PopupTemplate="{StaticResource crosshairPopupTemplate}" />
            </dxc:ChartControl.CrosshairOptions>
            <!--#endregion-->
            <dxc:ChartControl.Diagram>
                <dxc:XYDiagram2D
                    EnableAxisXNavigation="True"
                    DependentAxesYRange="True">
                    <!--#region Axes-->
                    <dxc:XYDiagram2D.AxisX>
                        <dxc:AxisX2D
                            GridLinesVisible="True">
                            <dxc:AxisX2D.Label>
                                <dxc:AxisLabel
                                    TextPattern="{}{A:M/d/yyyy}" />
                            </dxc:AxisX2D.Label>
                            <dxc:AxisX2D.DateTimeScaleOptions>
                                <dxc:ManualDateTimeScaleOptions
                                    WorkdaysOnly="{Binding ElementName=cheWorkdaysOnly, Path=IsChecked}"
                                    MeasureUnit="Day" />
                            </dxc:AxisX2D.DateTimeScaleOptions>
                        </dxc:AxisX2D>
                    </dxc:XYDiagram2D.AxisX>
                    <dxc:XYDiagram2D.AxisY>
                        <dxc:AxisY2D
                            GridLinesMinorVisible="True">
                            <dxc:AxisY2D.WholeRange>
                                <dxc:Range
                                    dxc:AxisY2D.AlwaysShowZeroLevel="False" />
                            </dxc:AxisY2D.WholeRange>
                            <dxc:AxisY2D.Title>
                                <dxc:AxisTitle
                                    Content="US Dollars" />
                            </dxc:AxisY2D.Title>
                        </dxc:AxisY2D>
                    </dxc:XYDiagram2D.AxisY>
                    <!--#endregion-->
                    <dxc:XYDiagram2D.Series>
                        <dxc:StockSeries2D
                            DisplayName="Google inc"
                            Model="{Binding ElementName=lbeModel, Path=SelectedItem}"
                            AnimationAutoStartMode="SetStartState"
                            ArgumentDataMember="TradeDate"
                            HighValueDataMember="High" DataSourceSorted="True"
                            LowValueDataMember="Low"
                            OpenValueDataMember="Open"
                            CloseValueDataMember="Close"
                            ShowOpenClose="{Binding ElementName=cbeStockType, Path=SelectedItem}"
                            CrosshairLabelTemplate="{StaticResource crosshairLabelTemplate}"
                            Brush="{Binding ElementName=pceBaseColor, Path=EditValue, Converter={dxmvvm:ColorToBrushConverter}}">
                            <dxc:StockSeries2D.PointAnimation>
                                <dxc:Stock2DSlideFromTopAnimation
                                    PointDelay="0:0:0.00">
                                    <dxc:Stock2DSlideFromTopAnimation.EasingFunction>
                                        <PowerEase />
                                    </dxc:Stock2DSlideFromTopAnimation.EasingFunction>
                                </dxc:Stock2DSlideFromTopAnimation>
                            </dxc:StockSeries2D.PointAnimation>
                            <dxc:StockSeries2D.ReductionOptions>
                                <dxc:ReductionStockOptions
                                    Brush="{Binding ElementName=pceReductionColor, Path=EditValue, Converter={dxmvvm:ColorToBrushConverter}}"
                                    Level="{Binding ElementName=cbeReductionLevel, Path=EditValue}"
                                    ColorMode="{Binding ElementName=cbeReductionMode, Path=EditValue}" />
                            </dxc:StockSeries2D.ReductionOptions>
                        </dxc:StockSeries2D>
                    </dxc:XYDiagram2D.Series>
                </dxc:XYDiagram2D>
            </dxc:ChartControl.Diagram>
            <!--#region Legend-->
            <dxc:ChartControl.Legend>
                <dxc:Legend
                    HorizontalPosition="Left" />
            </dxc:ChartControl.Legend>
            <!--#endregion-->
            <!--#region Titles-->
            <dxc:ChartControl.Titles>
                <dxc:Title
                    Dock="Top"
                    HorizontalAlignment="Center">Stock Prices</dxc:Title>
                <dxc:Title
                    Dock="Bottom"
                    HorizontalAlignment="Right"
                    FontSize="12"
                    Foreground="Silver"
                    Margin="0,10,0,0">
                    From www.quandl.com
                </dxc:Title>
            </dxc:ChartControl.Titles>
            <!--#endregion-->
        </dxc:ChartControl>

    </DockPanel>
</local:TabItemModule>