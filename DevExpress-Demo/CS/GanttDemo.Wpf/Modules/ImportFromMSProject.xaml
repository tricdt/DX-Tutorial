<local:GanttDemoModule x:Class="GanttDemo.ImportFromMSProject"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
      xmlns:dxr="http://schemas.devexpress.com/winfx/2008/xaml/ribbon"
      xmlns:dxgn="http://schemas.devexpress.com/winfx/2008/xaml/gantt"
      xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
      xmlns:local="clr-namespace:GanttDemo"
      mc:Ignorable="d"
      d:DesignHeight="600"
      d:DesignWidth="1200"
      DataContext="{dxmvvm:ViewModelSource Type=local:ProjectViewModel}">
    <DockPanel>
        <local:GanttDemoRibbon DockPanel.Dock="Top" ExportGantt="{x:Reference gantt}" />
        <dxr:RibbonControl DockPanel.Dock="Top">
            <dxr:RibbonPage Caption="Demo">
                <dxr:RibbonPageGroup Caption="Import">
                    <dxb:BarButtonItem Content="Open MS Project XML" RibbonStyle="Large"
                                       LargeGlyph="pack://application:,,,/GanttDemo;component/Images/Ribbon/Open.svg"
                                       MediumGlyph="pack://application:,,,/GanttDemo;component/Images/Ribbon/Open.svg">
                        <dxmvvm:Interaction.Behaviors>
                            <dxmvvm:EventToCommand EventName="ItemClick" Command="{Binding LoadFileCommand}"/>
                        </dxmvvm:Interaction.Behaviors>
                    </dxb:BarButtonItem>
                </dxr:RibbonPageGroup>
            </dxr:RibbonPage>
        </dxr:RibbonControl>

        <dxgn:GanttControl x:Name="gantt" ItemsSource="{Binding Tasks}" ShowBorder="False">
            <dxgn:GanttControl.Columns>
                <dxgn:GanttColumn BindTo="Name" />
                <dxgn:GanttColumn BindTo="StartDate" />
                <dxgn:GanttColumn BindTo="FinishDate" />
                <dxgn:GanttColumn BindTo="Duration" />
            </dxgn:GanttControl.Columns>
            <dxgn:GanttControl.View>
                <dxgn:GanttView AutoExpandAllNodes="True"
                                AllowEditing="False"
                                AllowValidatePredecessorLinks="False"
                                TreeDerivationMode="Selfreference"
                                ParentFieldName="ParentUID"
                                KeyFieldName="UID"
                                StartDateMapping="StartDate"
                                FinishDateMapping="FinishDate"
                                BaselineStartDateMapping="BaselineStartDate"
                                BaselineFinishDateMapping="BaselineFinishDate"
                                ResourcesSource="{Binding Resources}"
                                ResourceLinksSource="{Binding ResourceLinks}"
                                NameMapping="Name"
                                Zoom="2:0:0"
                                TaskContentIndent="15"
                                ScrollMargin="15"
                                ProgressMapping="Progress"
                                PredecessorLinksPath="Predecessors"
                                WorkdayRulesSource="{Binding WorkdaysRules}"
                                WorkingTimeRulesSource="{Binding WorkingTimeRules}">
                    <dxgn:GanttView.PredecessorLinkMappings>
                        <dxgn:GanttPredecessorLinkMappings PredecessorTask="." />
                    </dxgn:GanttView.PredecessorLinkMappings>
                    <dxgn:GanttView.ResourceLinkMappings>
                        <dxgn:GanttResourceLinkMappings Resource="ResourceUID" Task="TaskUID" AllocationPercentage="Units"/>
                    </dxgn:GanttView.ResourceLinkMappings>
                    <dxgn:GanttView.ResourceMappings>
                        <dxgn:GanttResourceMappings Key="UID" Name="Name"/>
                    </dxgn:GanttView.ResourceMappings>
                    <dxgn:GanttView.TaskContentTemplate>
                        <DataTemplate>
                            <ItemsControl ItemsSource="{Binding ResourceLinks}" AlternationCount="1000">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text=", " x:Name="tbComma"/>
                                            <TextBlock Text="{Binding ResourceData.Name}"/>
                                            <TextBlock Text="{Binding AllocationPercentage, Mode=OneWay, StringFormat={} ({0:p0})}" x:Name="tbAllocation"/>
                                        </StackPanel>
                                        <DataTemplate.Triggers>
                                            <DataTrigger Binding="{Binding Path=(ItemsControl.AlternationIndex), RelativeSource={RelativeSource Mode=Self}}" Value="0">
                                                <Setter Property="Visibility" TargetName="tbComma" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Value="1" Binding="{Binding AllocationPercentage, Mode=OneWay}">
                                                <Setter TargetName="tbAllocation" Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </DataTemplate.Triggers>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </DataTemplate>
                    </dxgn:GanttView.TaskContentTemplate>
                </dxgn:GanttView>
            </dxgn:GanttControl.View>
        </dxgn:GanttControl>
    </DockPanel>
</local:GanttDemoModule>