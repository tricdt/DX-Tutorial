<UserControl x:Class="DevExpress.WindowsMailClient.Wpf.View.MailView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
    xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
    xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
    xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
    xmlns:dxgt="http://schemas.devexpress.com/winfx/2008/xaml/grid/themekeys"
    xmlns:dxei="http://schemas.devexpress.com/winfx/2008/xaml/editors/internal"
    xmlns:dxi="http://schemas.devexpress.com/winfx/2008/xaml/core/internal"
    xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
    xmlns:local="clr-namespace:DevExpress.WindowsMailClient.Wpf"
    xmlns:view="clr-namespace:DevExpress.WindowsMailClient.Wpf.View"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    mc:Ignorable="d"
    d:DesignHeight="800" d:DesignWidth="1000">
    <UserControl.Resources>
        <dx:BoolToObjectConverter x:Key="ShowMessageToVisibilityConverter" FalseValue="Hidden" TrueValue="Visible"/>
        <dx:BoolToObjectConverter x:Key="RowDetailsVisibilityModeConverter" FalseValue="Visible" TrueValue="Collapsed" />
        <dx:BoolToObjectConverter x:Key="ReadMessageToVisibilityConverter" FalseValue="Hidden" TrueValue="Visible"/>
        <dx:BoolToObjectConverter x:Key="EditMessageToVisibilityConverter" FalseValue="Visible" TrueValue="Hidden"/>

        <ControlTemplate x:Key="{dxgt:GridRowThemeKey ResourceKey=RowDetailsTemplate, IsThemeIndependent=True}"
                         TargetType="dxg:RowDetailsControl">
            <dx:DataContentPresenter x:Name="Content" />
        </ControlTemplate>
        <ControlTemplate x:Key="ElementSizerTemplate" TargetType="dxlc:ElementSizer">
            <dx:ThemedBorder x:Name="border" Background="{Binding BorderBrush, RelativeSource={RelativeSource Self}}">
                <dx:Container>
                    <Rectangle x:Name="VerticalRootElement" Width="4" Cursor="SizeWE" Fill="Transparent" />
                </dx:Container>
            </dx:ThemedBorder>
            <ControlTemplate.Triggers>
                <Trigger SourceName="border" Property="IsMouseOver" Value="False">
                    <Setter TargetName="border" Property="Background" Value="Transparent" />
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
        <Style x:Key="HighlightTextBox" TargetType="TextBlock">
            <Setter Property="dxei:TextBlockService.EnableTextHighlighting" Value="True" />
            <Setter Property="dxei:TextBlockService.HighlightedTextCriteria" Value="Contains" />
            <Setter Property="dxei:TextBlockService.HighlightedText" Value="{Binding Path=View.SearchString}" />
            <Setter Property="dxei:TextBlockService.HighlightedTextAppearance">
                <Setter.Value>
                    <dxe:HighlighterAppearance />
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="RowStyle" TargetType="dxg:RowControl">
            <Style.Triggers>
                <MultiTrigger>
                    <MultiTrigger.Conditions>
                        <Condition Property="IsMouseOver" Value="True" />
                        <Condition Property="dxg:TableView.IsFocusedRow" Value="False" />
                    </MultiTrigger.Conditions>
                    <Setter Property="Background" Value="{dxi:ThemeResource {dxgt:GridRowThemeKey ResourceKey=BorderSelectedBrush}}" />
                </MultiTrigger>
                <DataTrigger Binding="{Binding IsFocused}" Value="True">
                    <Setter Property="Background" Value="{dxi:ThemeResource {dxgt:GridRowThemeKey ResourceKey=BorderFocusedBrush}}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="{dxgt:TableViewThemeKey ResourceKey=CompactPanelOrderStyle, IsThemeIndependent=true}" TargetType="TextBlock">
            <Setter Property="Text">
                <Setter.Value>
                    <MultiBinding>
                        <Binding Path="FieldName" />
                        <Binding Path="SortOrder" />
                        <MultiBinding.Converter>
                            <view:OrderNameConverter />
                        </MultiBinding.Converter>
                    </MultiBinding>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="GroupRowControlStyle" TargetType="dxg:GroupRowControl">
            <Setter Property="IsEnabled" Value="False"/>
        </Style>
        <Style x:Key="LayoutItemSizerStyle" TargetType="dxlc:ElementSizer">
            <Setter Property="Template" Value ="{StaticResource ElementSizerTemplate}"/>
        </Style>
        <Style TargetType="{x:Type dxg:GridSearchControl}">
            <Setter Property="Height" Value="32"/>
        </Style>

        <DataTemplate x:Key="CompactRowTemplate">
            <DataTemplate.Resources>
                <Style x:Key="SubjectTextBoxStyle"
                   TargetType="TextBlock"
                   BasedOn="{StaticResource HighlightTextBox}">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding Row.IsUnread}" Value="True">
                            <Setter Property="Foreground" Value="#FF0072C6" />
                            <Setter Property="FontWeight" Value="SemiBold" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataTemplate.Resources>
            <ContentControl FontSize="15">
                <Grid Margin="0,1,20,1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="20" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="90" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Border Grid.RowSpan="3"
                            Width="4"
                            HorizontalAlignment="Left"
                            Visibility="{Binding Row.IsUnread, Converter={dx:BooleanToVisibilityConverter}}"
                            Background="#FF0072C6" />
                    <StackPanel Orientation="Horizontal" Grid.Column="1"
                                Margin="0,12,0,0">
                        <TextBlock Text="[Draft]"
                                   Foreground="Red"
                                   FontWeight="Normal"
                                   Visibility="{Binding Row.IsDraft, Converter={dx:BooleanToVisibilityConverter}}"
                                   Margin="0,0,4,0"/>
                        <TextBlock Text="{DXBinding 'Row.IsDraft ? $string.IsNullOrEmpty(Row.To) ? `(none)` : Row.To  : Row.FullName'}"
                                   TextTrimming="CharacterEllipsis"
                                   Style="{StaticResource SubjectTextBoxStyle}"
                                   Foreground="{dxi:ThemeResource {dxgt:GridControlThemeKey ResourceKey=Foreground}}"/>
                    </StackPanel>
                    <TextBlock x:Name="tbSubject"
                               Grid.Column="1"
                               Grid.Row="1"
                               Margin="0,0,0,0"
                               VerticalAlignment="Center" Style="{StaticResource SubjectTextBoxStyle}"
                               Text="{DXBinding '$string.IsNullOrEmpty(Row.Subject) ? `(no subject)` : Row.Subject'}"
                               TextTrimming="CharacterEllipsis" />
                    <TextBlock Style="{StaticResource HighlightTextBox}"
                               Grid.Column="1"
                               Grid.Row="2"
                               Margin="0,0,0,12"
                               VerticalAlignment="Center"
                               FontWeight="Normal"
                               Text="{Binding Row.PlainText}"
                               TextTrimming="CharacterEllipsis"
                               Foreground="#FF747474" />
                    <TextBlock Margin="0,7,0,0"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Right"
                               Grid.Column="2"
                               Grid.Row="1"
                               Text="{Binding Row.Date, Converter={view:DateTimeFormatConverter}}"
                               Style="{StaticResource SubjectTextBoxStyle}"
                               FontSize="12"
                               FontWeight="Normal"/>
                </Grid>
            </ContentControl>
        </DataTemplate>
        <DataTemplate x:Key="DetailRowTemplate">
            <TextBlock Style="{StaticResource HighlightTextBox}"
                       Margin="65,0,0,6" VerticalAlignment="Center"
                       FontSize="12"
                       Text="{Binding Row.PlainText}"
                       FontWeight="Normal"
                       TextTrimming="CharacterEllipsis"
                       Foreground="#FF747474" />
        </DataTemplate>
        <DataTemplate x:Key="GroupRowHeaderTemplate">
            <TextBlock Text="{Binding Row.FullDateString}"
                       VerticalAlignment="Center"
                       FontWeight="Normal"
                       FontSize="16"
                       Margin="20, 0, 0, 0">
            </TextBlock>
        </DataTemplate>
    </UserControl.Resources>

    <dxlc:LayoutControl Orientation="Horizontal" Padding="0" ItemSizerStyle="{StaticResource LayoutItemSizerStyle}">
        <Grid Width="730"
              Visibility="{Binding ShowContentMessage, Converter={StaticResource ShowMessageToVisibilityConverter}}"
              HorizontalAlignment="Right" dxlc:LayoutControl.AllowHorizontalSizing="True"
              Margin="-6,0,0,0">
            <local:MailMessageReadControl
                Padding="36,0,36,0"
                    DataContext="{Binding}"
                    Visibility="{Binding IsReadMessage, Converter={StaticResource ReadMessageToVisibilityConverter}}"/>
            <local:MailMessageEditControl
                Padding="36,0,36,0"
                    DataContext="{Binding}"
                    Visibility="{Binding IsReadMessage, Converter={StaticResource EditMessageToVisibilityConverter}}"/>
        </Grid>
        <dxlc:LayoutControl StretchContentVertically="True"
                            StretchContentHorizontally="True"
                            Padding="0"
                            Margin="0">
            <dxg:GridControl x:Name="grid"
                                 ItemsSource="{Binding SelectedFolder.Items}"
                                 SelectedItem="{Binding SelectedMessage, Mode=TwoWay}"
                                 AutoExpandAllGroups="True"
                                 dx:ScrollBarExtensions.ScrollBarMode="TouchOverlap"
                                 ShowBorder="True"
                                 Margin="-1,-1,0,-1"
                                 MinWidth="150"
                                 MinHeight="150"
                                 dxlc:LayoutControl.AllowHorizontalSizing="True"
                                 >
                <dxg:GridControl.Columns>
                    <dxg:GridColumn Width="Auto"
                                        FieldName="Date"
                                        GroupIndex="1"
                                        ShowGroupedColumn="True"
                                        GroupInterval="DateRange"
                                        SortOrder="Descending" />
                    <dxg:GridColumn Width="Auto"
                                        FieldName="From"/>
                    <dxg:GridColumn Width="Auto"
                                        FieldName="Subject"/>
                    <dxg:GridColumn Width="Auto"
                                        FieldName="SenderName"/>
                </dxg:GridControl.Columns>
                <dxg:GridControl.View>
                    <dxg:TableView x:Name="tableView"
                                       Header="{Binding SelectedFolder.Header}"
                                       HeaderPosition="CompactPanel"
                                       ShowColumnHeaders="False"
                                       CompactPanelShowMode="Always"
                                       SwitchToCompactModeWidth="{x:Static sys:Double.PositiveInfinity}"
                                       AllowEditing="False"
                                       LeftGroupAreaIndent="0"
                                       ShowSearchPanelMode="Always"
                                       SearchPanelNullText="Search Current Mailbox"
                                       DataRowCompactTemplate="{StaticResource CompactRowTemplate}"
                                       CompactFilterElementShowMode="List"
                                       CompactSortElementShowMode ="CompactMode"
                                       RowStyle="{StaticResource RowStyle}"
                                       ShowFilterPanelMode="Never"
                                       ShowGroupPanel="False"
                                       ShowIndicator="False"
                                       ShowVerticalLines="False"
                                       IsGroupRowMenuEnabled ="False"
                                       FocusedRow="{Binding SelectedMessage, Mode=TwoWay}"
                                       RowDetailsVisibilityMode="{Binding IsCompactMode, RelativeSource={RelativeSource Self}, Converter={StaticResource RowDetailsVisibilityModeConverter}}"
                                       RowDetailsTemplate="{StaticResource DetailRowTemplate}"
                                       NavigationStyle="Row"
                                       GroupRowTemplate="{StaticResource GroupRowHeaderTemplate}"
                                       GroupRowStyle="{StaticResource GroupRowControlStyle}">
                        <dxg:TableView.FormatConditions>
                            <dxg:FormatCondition ApplyToRow="True" Expression="[IsUnread] = True">
                                <dxg:FormatCondition.Format>
                                    <dxg:Format FontWeight="Bold" Foreground="#FF0072C6" />
                                </dxg:FormatCondition.Format>
                            </dxg:FormatCondition>
                        </dxg:TableView.FormatConditions>
                        <dxmvvm:Interaction.Behaviors>
                        </dxmvvm:Interaction.Behaviors>
                    </dxg:TableView>
                </dxg:GridControl.View>
            </dxg:GridControl>
        </dxlc:LayoutControl>
    </dxlc:LayoutControl>
</UserControl>